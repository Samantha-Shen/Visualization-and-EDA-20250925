---
title: "viz_i"
subtitle: "Part I"
output: html_document
date: "2025-09-25"
---

```{r setup}
library(tidyverse)
library(ggridges)
```


# Load the weather data

```{r}
library(p8105.datasets)
data("weather_df")
```

# Scatterplots!!

```{r}
ggplot(weather_df, aes(x=tmin, y=tmax)) +
  geom_point()
```


New approach, same plot

```{r}
weather_df %>%
  ggplot(aes(x=tmin, y=tmax)) +
  geom_point()
```

Save and edit a plot object.

```{r}
weather_plot=
  weather_df %>%
  ggplot(aes(x=tmin, y=tmax))

weather_plot + geom_point()
```


## Advanced scatterplot

Start with the same one and make it fancy!

```{r}
weather_df %>%
  ggplot(aes(x=tmin, y=tmax, color=name)) +
  geom_point()+
  geom_smooth(se=FALSE)
```
（aes 在 ggplot() 中全局映射，color=name 成为全局设置，所有图层（点和拟合线）都按 name 分组着色，会为每个 name 分别绘制一条对应颜色的拟合线）





What about the `aes` placement?

```{r}
weather_df %>%
  ggplot(aes(x=tmin, y=tmax)) +
  geom_point(aes(color=name)) +
  geom_smooth()
```
（aes 在 geom_point() 中局部映射，color=name 只作用于点图层，只有散点按 name 分组着色，所有数据点一起拟合，只生成一条总的拟合线）





Let's facet some things!

(facet_grid(行变量~列变量)，如果没有变量用‘.’代替)

```{r}
weather_df %>%
  ggplot(aes(x=tmin, y=tmax, color=name)) +
  geom_point(alpha=.2)+
  geom_smooth(se=FALSE, size=1.5) +
  facet_grid(.~ name)
```
(alpha 参数控制透明度, 取值范围：0（完全透明）到 1（完全不透明）)

Or write like this:

```{r}
weather_df %>%
  ggplot(aes(x=tmin, y=tmax, alpha=tmin, color=name)) +
  geom_point()+
  geom_smooth(se=FALSE, size=1.5) +
  facet_grid(.~ name)
```




```{r}
weather_df %>%
  ggplot(aes(x=tmin, y=tmax, color=name)) +
  geom_point()+
  geom_smooth(se=FALSE) +
  facet_grid(name~.)
```



Let's combine some elements and try a new plot.

```{r}
weather_df %>%
  ggplot(aes(x=date, y=tmax, color=name)) +
  geom_point(aes(size = prcp),alpha=.5)+
  geom_smooth(se=FALSE)+
  facet_grid(.~ name)
```



## Some small notes

How many geoms have to exist?
You can have whatever geoms you want.

```{r}
weather_df %>%
  ggplot(aes(x=tmin, y=tmax, color=name))+
  geom_smooth(se=FALSE)
```

You can use a neat geom!

```{r}
weather_df %>%
  ggplot(aes(x=tmin, y=tmax))+
  geom_hex()
```

```{r}
weather_df %>%
  ggplot(aes(x=tmin, y=tmax))+
  geom_bin_2d()
```

```{r}
weather_df %>%
  ggplot(aes(x=tmin, y=tmax))+
  geom_density_2d()+
  geom_point()
```


# Univariate plots

### Histograms are really great.

```{r}
weather_df %>%
  ggplot(aes(x=tmin))+
  geom_histogram()
```

Can we add color..

```{r}
weather_df %>%
  ggplot(aes(x=tmin, fill=name))+
  geom_histogram(position = "dodge")+
  facet_grid(.~name)
```
(position = "dodge"：让不同组别的条形并排显示，而不是堆叠在一起)
(position = "stack"：（堆叠，默认值）)
(position = "fill"（比例堆叠）)


Let's try a new geometry!


```{r}
weather_df %>%
  ggplot(aes(x=tmin, fill=name))+
  geom_density(alpha=.3)
```

```{r}
weather_df %>%
  ggplot(aes(x=tmin, fill=name))+
  geom_density(alpha=.4, adjust=.5)
```
(adjust 参数：调整密度估计的带宽（bandwidth）
adjust = 1：使用默认带宽（标准平滑度）
adjust < 1：减小带宽 → 曲线更崎岖、更多细节
adjust > 1：增大带宽 → 曲线更平滑、更概化)


### What about box plot?

```{r}
weather_df %>%
  ggplot(aes(x=name, y=tmin))+
  geom_boxplot()
```

### Trendy plots :-)

```{r}
weather_df %>%
  ggplot(aes(x=name, y=tmin, fill=name)) +
  geom_violin(alpha=.5)+
stat_summary()
```

(stat_summary():统计汇总函数，在数据上自动计算并显示摘要统计量,默认计算每个 x 分组的 y 值的均值并用点表示)


### Ridge plots --- most popular plot of 2017

```{r}
weather_df %>%
  ggplot(aes(x=tmin, y=name))+
  geom_density_ridges()
```


# Save and Embed

### Let's save a scatterplot.
```{r}
weather_plot=
  weather_df %>%
  ggplot(aes(x=tmin, y=tmax, color=name))+
  geom_point(alpha=.5)

ggsave("./results/weather_plot.pdf", weather_plot, width = 8, height = 5)
```

### What about embedding...

```{r}
weather_plot
```


Embed at different size:

```{r, fig.width=6,fig.height=3}
weather_plot
```







